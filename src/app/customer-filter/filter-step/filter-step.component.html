<div class="step-item">
  @let currentStep = step();
  @let currentIndex = stepIndex();
  @let onlyStep = isOnlyStep();
  <app-filter-step-header
    [step]="currentStep"
    [stepIndex]="currentIndex"
    [isOnlyStep]="onlyStep"
    (duplicate)="duplicate.emit($event)"
    (remove)="remove.emit($event)"
  ></app-filter-step-header>

  <div class="field-wrapper">
    <app-filter-step-event-selector
      [step]="currentStep"
      [events]="events()"
      (eventSelect)="onEventSelected($event)"
      (clearEvent)="onEventCleared()"
    ></app-filter-step-event-selector>

    <app-filter-step-attributes-panel
      [stepId]="currentStep.id"
      [eventType]="currentStep.eventType"
      [attributes]="currentStep.attributes"
      [availableAttributes]="selectedEvent()?.properties ?? []"
      (addAttribute)="addAttribute.emit($event)"
      (attributePropertyChange)="attributePropertyChange.emit($event)"
      (attributeOperatorChange)="attributeOperatorChange.emit($event)"
      (attributeValueChange)="attributeValueChange.emit($event)"
      (removeAttribute)="removeAttribute.emit($event)"
    ></app-filter-step-attributes-panel>
  </div>

  <mat-divider></mat-divider>
</div>
